{% extends "base.html" %}
{% block body %}

<section class="column">
    <div class="card" id="stats-card">

        <div class="stats" id="stat-followers">
            <h3 class="stats-label">Followers</h3>
            <div class="stats-value">{{followers}}</div>
        </div>

        <div class="stats" id="stat-active">
            <h3 class="stats-label">Active</h3>
            <div class="stats-value">{{active}}</div>
        </div>

        <div class="stats" id="stat-disabled">
            <h3 class="stats-label">Disabled</h3>
            <div class="stats-value">{{disabled}}</div>
        </div>

        <div class="stats" id="stat-ghost">
            <h3 class="stats-label">Never Posted</h3>
            <div class="stats-value">{{never_posted}}</div>
        </div>

    </div>

    <div class="card graph-container">
        <canvas id="follower-time-chart"></canvas>
    </div>
</section>
<script>
    const data = {{ timeseries | tojson }};
    
    const ctx = document.getElementById('follower-time-chart');
    new Chart(ctx, {
        type: 'line',
        data: {
            labels: data.map(d => d.timestamp),
            datasets: [{
                label: 'Total Followers',
                data: data.map(d => d.total_followers),
                borderColor: 'rgb(75, 192, 192)',
                tension: 0.1
            }, {
                label: 'Active Followers',
                data: data.map(d => d.active_count),
                borderColor: 'rgb(255, 99, 132)',
                tension: 0.1
            }]
        },
        options: {
            responsive: true,
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });
</script>

<section class="column">
    <div class="card" id="newfollowers">
        <header class="stats-label">New Followers</header>
        <div class="follower-changes">
            {% for did, handle in new_followers.items() %}
                <div class="follower-item">
                    <img src="https://via.placeholder.com/40" alt="avatar">
                    <a href="https://bsky.app/profile/{{ handle }}" target="_blank">
                        @{{ handle }}
                    </a>
                </div>
            
            {% endfor %}
            
            {% if new_followers|length > 5 %}
                <p>... and {{ new_followers|length - 5}} more</p>
        {% endif %}
        </div>
    </div>

    <div class="card" id="unfollows">
        <header class="stats-label">Unfollows</header>
        <div class="follower-changes">
            {% for did, handle in unfollows.items() %}
                <div class="follower-item">
                    <img src="https://via.placeholder.com/40" alt="avatar">
                    <a href="https://bsky.app/profile/{{ handle }}" target="_blank">
                        @{{ handle }}
                    </a>
                </div>
            {% endfor %}
            
            {% if unfollows|length > 5 %}
                <p>... and {{ unfollows|length - 5}} more</p>
            {% endif %}
        </div>
    </div>
</section>

{% endblock %}